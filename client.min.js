var data=function(n){"use strict";function e(){throw new Error("Dynamic requires are not currently supported by rollup-plugin-commonjs")}function t(n){return function(e){return e==n}}function r(n,e,t,o){var u=t.shift();if(!w[e])return!1;if(t.length){if(!(u in n)){if("remove"==e)return!0;n[u]={}}return r(n[u],e,t,o)}return w[e](n,u,o),!0}n=n&&n.hasOwnProperty("default")?n.default:n;var o="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},u=t;t.fn=function(n){return"function"==typeof n},t.str=function(n){return"string"==typeof n},t.num=function(n){return"number"==typeof n},t.obj=function(n){return"object"==typeof n},t.lit=function(n){return"object"==typeof n&&!(n instanceof Array)},t.bol=function(n){return"boolean"==typeof n},t.truthy=function(n){return 1==!!n},t.falsy=function(n){return 0==!!n},t.arr=function(n){return n instanceof Array},t.null=function(n){return null===n},t.def=function(n){return void 0!==n},t.in=function(n){return function(e){return!!n&&(n.indexOf?~n.indexOf(e):e in n)}},t.promise=function(n){return n instanceof Promise},t.stream=function(n){return!(!n||!n.next)};var i=function(n){return Object.keys(u.obj(n)||u.fn(n)?n:{})},f=function(n,e){return function(t){return e[t]=n[t],t}},a=function(n){return function(e){return i(e).map(f(e,n)),n}},c=function(n){return function(){return n}},l=function(n){return 0===n?"0":n?u.fn(n)?""+n:u.obj(n)?JSON.stringify(n):String(n):""},s=function n(e,t){var r=arguments.length>1,o=u.fn(e)?[]:l(e).split("."),i=o.shift();return function(f,a){var l={};return f?u.num(e)||e?u.arr(e)?(e.map(function(e){var t=n(e)(f);void 0!=t&&n(e,u.fn(t)?c(t):t)(l)}),l):f[e]||!o.length?r?(f[e]=u.fn(t)?t(f[e],a):t,f):u.fn(e)?e(f):f[e]:r?(n(o.join("."),t)(f[i]?f[i]:f[i]={}),f):n(o.join("."))(f[i]):f:void 0}},d=function(n,e){var t=1==arguments.length;return function(r){return r&&r.headers?t?s(n)(r.headers):s(n)(r.headers)==e:null}},p=function(n){return function(){return!n.apply(this,arguments)}},h=function(n){return function(e){return i(e).filter(p(u.in(n))).map(f(e,n)),n}},y=function n(e,t){var r=arguments.length;return u.str(e)||2!=r?u.str(e)||3!=r?function(n){var o=this||{};return n=o.nodeName||u.fn(o.node)?o:n,n=n.node?n.node():n,n=n.host||n,r>1&&!1===t?n.removeAttribute(e):r>1?(n.setAttribute(e,t),t):n.attributes.getNamedItem(e)&&n.attributes.getNamedItem(e).value}:n(arguments[1],arguments[2]).call(this,arguments[0]):n(arguments[1]).call(this,arguments[0])},g=function(){var n,e,t=new Promise(function(t,r){n=t,e=r});return arguments.length&&n(arguments[0]),t.resolve=n,t.reject=e,t},m=function n(e,t){return t instanceof Array&&(t=t.reduce(n,[])),(e=e||[]).concat(t)},v=function(n,e){return e in n},b=function(n,e,t,r){return n.host&&n.host.nodeName&&(n=n.host),e.name&&(t=e,e=e.name),!v(n,e)&&Object.defineProperty(n,e,{value:t,writable:r}),n[e]},x=function n(e){function t(n,t){return n.next?n.next(t):t instanceof Array?n.apply(e,t):n.call(e,t)}function r(n,e){for(var t=n.length;~--t;)e!=n[t]&&e!=n[t].fn&&e||n.splice(t,1)}function o(e,t){var u=n((t=t||{}).base||g());return u.i=0,u.li=[],u.fn=t.fn,u.parent=e,u.source=t.fn?u.parent.source:u,u.on("stop",function(){return u.type?u.parent.off(u.type,u):u.parent.off(u)}),u.each=function(n){var e=n.next?n:o(u,{fn:n});return u.li.push(e),e},u.pipe=function(n){return n(u)},u.map=function(n){return u.each(function(e,t,r){return r.next(n(e,t,r))})},u.filter=function(n){return u.each(function(e,t,r){return n(e,t,r)&&r.next(e)})},u.reduce=function(n,e){return u.each(function(t,r,o){return o.next(e=n(e,t,r,o))})},u.unpromise=function(){var n=o(u,{base:{},fn:function(e){return n.next(e)}});return u.li.push(n),n},u.next=function(n){return u.resolve&&u.resolve(n),u.li.length?u.li.map(function(e){return e.fn(n,e.i++,e)}):n},u.until=function(n){return n.each(function(){u.source.emit("stop")}),u},u.off=function(n){return r(u.li,n),u},u[Symbol.asyncIterator]=function(){return{next:function(){return u.wait=new Promise(function(n){u.wait=!0,u.map(function(e,t,r){delete u.wait,u.off(r),n({value:e,done:!1})}),u.emit("pull",u)})}}},u}return e=e||{},b(e,"emit",function(n,r,o){for(var u=e.on[n.split(".")[0]]||[],i=[],f=0;f<u.length;f++)u[f].ns&&o&&!o(u[f].ns)||i.push(t(u[f].isOnce?u.splice(f--,1)[0]:u[f],r));for(f=0;f<e.on["*"].length;f++)i.push(t(e.on["*"][f],[n,r]));return i.reduce(m,[])},1),b(e,"once",function(n,t){return e.on(n,t,!0)},1),b(e,"off",function(n,t){return r(e.on[n]||[],t),t&&t.ns&&delete e.on[n]["$"+t.ns],e},1),b(e,"on",function(n,t,u){function i(n){return n.isOnce=u,n.type=f,a&&(e.on[f]["$"+(n.ns=a)]=n),c.push(n),n.next?n:e}var f=n.split(".")[0],a=n.split(".")[1],c=e.on[f]=e.on[f]||[],l="function"==typeof t?t:0;return!l&&a?(l=e.on[f]["$"+a])?l:i(o(e,t)):l||a?l&&a?i((r(c,e.on[f]["$"+a]||-1),l)):!(!l||a)&&i(l):i(o(e,t))},1),e.on["*"]=e.on["*"]||[],e},w={add:function(n,e,t){u.arr(n)?n.splice(e,0,t):n[e]=t},update:function(n,e,t){n[e]=t},remove:function(n,e){u.arr(n)?n.splice(e,1):delete n[e]}},j=JSON.stringify,O=JSON.parse,A=function(n,e){return function(t,o,i){if(!u.obj(t)&&!u.fn(t))return t;if(!u.obj(n)){var f=o||t.log||[],a=t;if(u.def(i)||(i=f.max||0),i||(f=[]),i<0&&(f=f.concat(null)),i>0){var c=j(t);a=O(c),f=f.concat({type:"update",value:O(c),time:f.length})}return b(f,"max",i),a.log?a.log=f:b(x(a),"log",f,1),a}return!!u.def(n.key)&&(!!r(t,n.type,(n.key=""+n.key).split("."),n.value)&&(t.log&&t.log.max&&t.log.push((n.time=t.log.length,t.log.max>0?n:null)),!e&&t.emit&&t.emit("change",n),t))}},N={arr:function(n){return Array.prototype.slice.call(n,0)},obj:function(n){function e(n,e,r){return 0===r&&(n={}),n[u.fn(t)?t(e,r):e[t]]=e,n}var t="id";return 1==arguments.length?(t=n,e):e.apply(this,arguments)}},S="undefined"!=typeof window?window:o,k=function(n){return function(e){if(!S.console||!console.log.apply)return e;u.arr(arguments[2])&&(arguments[2]=arguments[2].length);var t=N.arr(arguments),r="[log]["+(new Date).toISOString()+"]"+n;return t.unshift(r.grey?r.grey:r),console.log.apply(console,t),e}}("[ri/types/data]"),P=s("body.on");return function(t){return k("creating"),t.on("change.data").filter(function(n){var e=n[0];return d("content-type","application/data")(t.resources[e])}).filter(function(n){var e=n[1];return e&&e.key}).map(function(n){var e=n[0],r=n[1];return t.resources[e].body.emit("change",r||null,p(u.in(["bubble"])))}),t.types["application/data"]={header:"application/data",ext:"*.data.js",selector:function(n){return'[data~="'+n.name+'"]'},extract:function(n){return(y("data")(n)||"").split(" ")},check:function(n){return u.obj(n.body)},load:function(r){var o=e(r.headers.path);return o=o.default||o,o=u.fn(o)?o(t):o,r.headers["content-type"]=this.header,t(n(r)(o)),t.resources[r.name]},parse:function(n){var e=t.resources[n.name]||{};return h(n.headers)(e.headers),n.body=A()(n.body||[],e.body&&e.body.log,u.num(n.headers.log)?n.headers.log:-1),a(n.body.on)(P(e)),n.body.on("change.bubble",function(e){t.emit("change",t.change=[n.name,e],p(u.in(["data"]))),delete t.change}),n.headers.loaded&&!n.headers.loading&&(n.headers.loading=Promise.resolve(n.headers.loaded(t,n)).then(function(){return delete n.headers.loading,n})),n}},t}}(merge);
